# Keboda数据建模Case--ESB接口定义

## 1. 接口列表

| 方法名          | uri  | 方法说明                                                     |
| --------------- | ---- | ------------------------------------------------------------ |
| getIMDataByDate | ***  | 获取指定日期的所有来料数据（IncomingMaterial）（已包含表头跟表体） |
| getIMHeadByDate |      | 获取指定日期的来料表头                                       |
| getIMBodyByDate |      | 获取指定日期的来料表体                                       |



## 2. 接口明细

### 2.1 getIMHeadByDate

#### 2.1.1 请求参数

| 字段名     | 数据类型 | 是否可空 | 示例数据 | 备注                                               |
| ---------- | -------- | -------- | -------- | -------------------------------------------------- |
| TStartDate | Date     | 是       | 2018-9-5 | 起始日期<br />为空，则表示没有其实时间限制；       |
| TEndDate   | Date     | 是       | 2018-9-5 | 截止日期<br />为空，则表示截至当前时间；           |
| NPageSize  | Int      | 是       | 100      | 分页大小<br />为空，则默认不分页，一次查询全量返回 |
| NCurPage   | Int      | 是       | 1        | 当前页码<br />启用分页时，该值若为空，则默认第1页  |

#### 2.1.2 响应参数

##### 2.1.2.1 分页信息节点

| 字段名     | 数据类型 | 是否可空 | 示例数据 | 备注                                       |
| ---------- | -------- | -------- | -------- | ------------------------------------------ |
| NTotalRow  | Int      | 否       | 1000     | 总记录数                                   |
| NTotalPage | Int      | 否       | 10       | 总页码，不启用分页的情况下默认为1          |
| NPageSize  | Int      | 否       | 100      | 分页大小，不启用分页的情况下默认为总记录数 |
| NCurPage   | Int      | 否       | 1        | 当前页码，不启用分页的情况下默认为第1页    |

#### 

##### 2.1.2.2 数据节点

| 字段名    | 数据类型 | 是否可空 | 备注         | 示例数据 |
| --------- | -------- | -------- | ------------ | -------- |
| CDANHAO   | VARCHAR  | 是       | 收料确认单号 |          |
| TC_WDE20  | DATE     | 是       | 收料确认时间 |          |
| TC_WDE21  | VARCHAR  | 是       | 收料人员     |          |
| TC_WDE200 | VARCHAR  | 是       | 状态         |          |
| CFLAG     | VARCHAR  | 是       | 单据性质     |          |
| TC_WDE51  | VARCHAR  | 是       | 备用字段1    |          |
| TC_WDE52  | VARCHAR  | 是       | 备用字段2    |          |
| TC_WDE53  | VARCHAR  | 是       | 备用字段3    |          |
| TC_WDE54  | VARCHAR  | 是       | 备用字段4    |          |

#### 2.1.3 接口报文

##### 2.1.3.1 请求报文

```JSON
{"TStartDate":1000,"TEndDate":10,"NPageSize":100,"NCurPage":1}
```

##### 2.1.3.2 响应报文

```json
{
   "page":{"NTotalRow":1000,"NTotalPage":1,"NPageSize":100,"NCurPage":1},
   "data":[
       {"DH":"001",...},
       {"DH":"002",...},
       {"DH":"003",...}
    ]    
}
```



### 2.2 getIMBodyByDate

#### 2.1.1 请求参数

| 字段名     | 数据类型 | 是否可空 | 示例数据 | 备注                                               |
| ---------- | -------- | -------- | -------- | -------------------------------------------------- |
| TStartDate | Date     | 是       | 2018-9-5 | 起始日期<br />为空，则表示没有其实时间限制；       |
| TEndDate   | Date     | 是       | 2018-9-5 | 截止日期<br />为空，则表示截至当前时间；           |
| NPageSize  | Int      | 是       | 100      | 分页大小<br />为空，则默认不分页，一次查询全量返回 |
| NCurPage   | Int      | 是       | 1        | 当前页码<br />启用分页时，该值若为空，则默认第1页  |

#### 2.1.2 响应参数

##### 2.1.2.1 分页信息节点

| 字段名     | 数据类型 | 是否可空 | 示例数据 | 备注                                       |
| ---------- | -------- | -------- | -------- | ------------------------------------------ |
| NTotalRow  | Int      | 否       | 1000     | 总记录数                                   |
| NTotalPage | Int      | 否       | 10       | 总页码，不启用分页的情况下默认为1          |
| NPageSize  | Int      | 否       | 100      | 分页大小，不启用分页的情况下默认为总记录数 |
| NCurPage   | Int      | 否       | 1        | 当前页码，不启用分页的情况下默认为第1页    |

#### 

##### 2.1.2.2 数据节点

| 字段名       | 数据类型  | 是否可空 | 备注         | 示例数据 |
| ------------ | --------- | -------- | ------------ | -------- |
| CDANHAO      | VARCHAR   | 否       | 收料单号     |          |
| CBARCODENO   | VARCHAR   | 否       | 条码信息     |          |
| CBOXID       | VARCHAR   | 是       | 箱码         |          |
| CPRODUCENO   | VARCHAR   | 是       | 品号         |          |
| CPRODUCENAME | VARCHAR   | 是       | 品名         |          |
| CGUIGE       | VARCHAR   | 是       | 规格         |          |
| CDC          | VARCHAR   | 是       | DC           |          |
| IQTY         | DOUBLE(18 | 是       | 数量         |          |
| TC_WDF20     | DATE      | 是       | 收料确认时间 |          |
| TC_WDF21     | VARCHAR   | 是       | 收料人员     |          |
| TC_WDF200    | VARCHAR   | 是       | 状态         |          |
| CFLAG        | VARCHAR   | 是       | 单据性质     |          |
| TC_WDF51     | VARCHAR   | 是       | 质检货位     |          |
| TC_WDF52     | VARCHAR   | 是       | 备用字段2    |          |
| TC_WDF53     | VARCHAR   | 是       | 备用字段3    |          |
| TC_WDF54     | VARCHAR   | 是       | 备用字段4    |          |

#### 2.1.3 接口报文

##### 2.1.3.1 请求报文

```JSON
{"TStartDate":1000,"TEndDate":10,"NPageSize":100,"NCurPage":1}
```

##### 2.1.3.2 响应报文

```json
{
   "page":{"NTotalRow":1000,"NTotalPage":10,"NPageSize":100,"NCurPage":1},
   "data":[
       {"DH":"001","BC":"001"...},
       {"DH":"001","BC":"002"...},
       {"DH":"002","BC":"003"...},
   ]    
}
```





## 0. 其他

### 0.1 数据源分类 

MasterData：主数据，如客户信息，仓库信息，产品信息等基础数据；

BusinessData：业务数据，如交易订单，出入库单，库存信息等运营数据。

### 0.2 接口分类

全量数据获取接口：可直接获取相关表的全量数据，主要用来获取MatarData主数据信息

批量数据获取接口：可获取指定范围内的批量数据，主要用来获取指定时间范围（或者指定月份、日期）内的所有交易数据

### 0.3 疑点

1. 当数据存在多张表时，该接口应该如何设计更为合理， 例如： 

   > 来料数据分别存在于`来料表头`以及`来料表体`中， 在获取来料数据时，是让接口处理关联查询`来料表头 full outer join 来料表体 `更好还将`表头`和`表体`分别提供各自查询接口更好？


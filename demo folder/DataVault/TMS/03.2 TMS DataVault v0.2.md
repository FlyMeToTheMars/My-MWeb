# TMS Data Vault

## 0. 设计流程

1. 梳理DV模型，识别各表主键及其所包含的字段属性
2. 新建Hub中心表、Link链接表、Sat卫星表
3. 开发脚本，将数据从stage区加载到DataVault各表中



## 1. DV模型图

> 京顺达DV模型图
>
> ![1540309374753](../../../demo%20folder/DataVault/TMS/assets/1540309374753.png)



## 2.中心表

### 2.1 主键

| name     | code              | BK                  | PK            |
| -------- | ----------------- | ------------------- | ------------- |
| 运单表   | HubWayBill        | TransportNR(运单号) | WayBillHK     |
| 运单明细 | HubCar            | VIN                 | CarHK         |
| 订单表   | HubAssignOrder    | OrderNR             | AssignOrderHK |
| 任务管理 | HubTaskManagement | TaskNumber          | TaskHK        |

### 2.2 中心表结构

| Table                 | Column             | KeyType |
| --------------------- | ------------------ | ------- |
| **HubWayBill**        | **HWayBillHK**     | **PK**  |
| HubWayBill            | LoadDate           |         |
| HubWayBill            | RecordSource       |         |
| HubWayBill            | TransportNR        | BK      |
| **HubCar**            | **HCarHK**         | **PK**  |
| HubCar                | LoadDate           |         |
| HubCar                | RecordSource       |         |
| HubCar                | VIN                | BK      |
| **HubAssignOrder**    | **HAssignOrderHK** | **PK**  |
| HubAssignOrder        | LoadDate           |         |
| HubAssignOrder        | RecordSource       |         |
| HubAssignOrder        | OrderNR            | BK      |
| **HubTaskManagement** | **HTaskHK**        | **PK**  |
| HubTaskManagement     | LoadDate           |         |
| HubTaskManagement     | RecordSource       |         |
| HubTaskManagement     | TaskNumber         | BK      |

### 2.3 建表脚本

```sql
/** HubWaybill*/				
	create table datavault.HubWayBill(			
		HWayBillHK	String	
	,	LoadDate	bigint	
	,	RecordSource	String	
	,	TransportNR	String	
	,Primary Key(HWayBillHK)			
	)			
	Partition By Hash(HWayBillHK)Partitions 6			
	stored as kudu;			
				
/**HubCar*/				
	create table datavault.HubCar(			
		HCarHK	String	
	,	LoadDate	bigint	
	,	RecordSource	String	
	,	VIN	String	
	,Primary Key(HCarHK)			
	)			
	Partition By Hash(HCarHK)Partitions 6			
	stored as kudu;			
				
/**HubAssignOrder*/				
	create table datavault.HubAssignOrder(			
		HAssignOrderHK	String	
	,	LoadDate	bigint	
	,	RecordSource	String	
	,	OrderNR	String	
	,Primary Key(HAssignOrderHK)			
	)			
	Partition By Hash(HAssignOrderHK)Partitions 6			
	stored as kudu;			
				
/**HubTask*/				
	create table datavault.HubTask(			
		HTaskHK	String	
	,	LoadDate	bigint	
	,	RecordSource	String	
	,	TaskNumber	String	
	,Primary Key(HTaskHK)			
	)			
	Partition By Hash(HTaskHK)Partitions 6			
	stored as kudu;			

```

### 2.4 Load Hub

```sql
/**HubWaybill*/	
insert into table datavault.HubWayBill	select distinct
	s.HWayBillHK
,	s.LoadDate
,	s.RecordSource
,	s.TransportNR
from stagearea.tms_waybill s
where s.TransportNR not in (select t.TransportNR from datavault.HubWayBill t )
and loaddate = ${loaddate};
	
/**HubCar*/	
insert into table datavault.HubCar	select distinct
	s.HCarHK
,	s.LoadDate
,	s.RecordSource
,	s.VIN
from stagearea.tms_orders s
where s.VIN not in (select t.VIN from datavault.HubCar t )
and loaddate = ${loaddate};

/**HubAssignOrder*/	
insert into table datavault.HubAssignOrder select distinct
	s.HAssignOrderHK
,	s.LoadDate
,	s.RecordSource
,	s.OrderNR
from stagearea.tms_AssignOrder s
where s.OrderNR not in (select t.OrderNR from datavault.HubAssignOrder t )
and loaddate = ${loaddate};

/**HubTask*/	
insert into table datavault.HubTask	select distinct
	s.HTaskHK
,	s.LoadDate
,	s.RecordSource
,	s.TaskNumber
	from stagearea.tms_TaskManagement s
where s.TaskNumber not in (select t.TaskNumber from datavault.HubTask t )
and loaddate = ${loaddate};

```



## 3.链表

### 3.1 主键值

| name               | code                  | BK                                    | PK                   | FK                            |
| ------------------ | --------------------- | ------------------------------------- | -------------------- | ----------------------------- |
| 运单明细链接表     | LinkOrder             | TransportNR,      VIN                 | LOrderHK             | HWayBillHK,      HCarHK       |
| 订单拼单链接表     | LinkOrdersAssignOrder | TransportNR,      VIN,        OrderNR | LOrdersAssignOrderHK | LOrderHK,      HAssignOrderHK |
| 辅助订单任务链接表 | LinkAssignOrderTask   | OrderNR,      TaskNumber              | LAssignOrderTaskHK   | HAssignOrderHK,     HTaskHK   |

### 3.2 链接表结构



| Table                     | Column                   | KeyType |
| ------------------------- | ------------------------ | ------- |
| **LinkOrder**             | **LOrderHK**             | **PK**  |
| LinkOrder                 | LoadDate                 |         |
| LinkOrder                 | RecordSource             |         |
| LinkOrder                 | HWayBillHK               | FK      |
| LinkOrder                 | HCarHK                   | FK      |
| **LinkOrdersAssignOrder** | **LOrdersAssignOrderHK** | **PK**  |
| LinkOrdersAssignOrder     | LoadDate                 |         |
| LinkOrdersAssignOrder     | RecordSource             |         |
| LinkOrdersAssignOrder     | LOrderHK                 | FK      |
| LinkOrdersAssignOrder     | HAssignOrderHK           | FK      |
| **LinkAssignOrderTask**   | **LAssignOrderTaskHK**   | **PK**  |
| LinkAssignOrderTask       | LoadDate                 |         |
| LinkAssignOrderTask       | RecordSource             |         |
| LinkAssignOrderTask       | HAssignOrderHK           | FK      |
| LinkAssignOrderTask       | HTaskHK                  | FK      |

### 3.3 建表脚本

```sql
/**LinkOrder*/		
create table datavault.LinkOrder(		
	LOrderHK	String
,	LoadDate	bigint
,	RecordSource	string
,	HWayBillHK	string
,	HCarHK	string
,Primary Key(LOrderHK)		
)		
Partition By Hash(LOrderHK)Partitions 6		
stored as kudu;		
		
/**LinkOrdersAssignOrder*/		
create table datavault.LinkOrderAssignOrder(		
	LOrdersAssignOrderHK	String
,	LoadDate	bigint
,	RecordSource	string
,	LOrderHK	string
,	HAssignOrderHK	string
,Primary Key(LOrdersAssignOrderHK)		
)		
Partition By Hash(LOrdersAssignOrderHK)Partitions 6		
stored as kudu;		
		
/**LinkAssignOrderTask*/		
create table datavault.LinkAssignOrderTask(		
	LAssignOrderTaskHK	String
,	LoadDate	bigint
,	RecordSource	string
,	HAssignOrderHK	string
,	HTaskHK	string
,Primary Key(LAssignOrderTaskHK)		
)		
Partition By Hash(LAssignOrderTaskHK)Partitions 6		
stored as kudu;

```

### 3.4 Load Link

```sql
/**LinkOrder*/	
insert into table datavault.LinkOrder	select distinct
	s.LOrderHK
,	s.LoadDate
,	s.RecordSource
,	s.HWayBillHK
,	s.HCarHK
from stagearea.tms_Orders s
where not exists (select 1 from datavault.LinkOrder t where t.HWayBillHK = s.HWayBillHK and t.HCarHK = s.HCarHK )
and s.LoadDate=${loaddate}
;

/**LinkOrderAssignOrder*/	
insert into table datavault.LinkOrderAssignOrder	select distinct
	s.LOrderAssignOrderHK
,	s.LoadDate
,	s.RecordSource
,	s.LOrderHK
,	s.HAssignOrderHK
from stagearea.tms_AssignOrderDetail s
where not exists (select 1 from datavault.LinkOrderAssignOrder t where t.LOrderHK = s.LOrderHK and t.HAssignOrderHK = s.HAssignOrderHK )
and s.LoadDate=${loaddate}
;
	
/**LinkAssignOrderTask*/	
insert into table datavault.LinkAssignOrderTask	select distinct
	s.LAssignOrderTaskHK
,	s.LoadDate
,	s.RecordSource
,	s.HAssignOrderHK
,	s.HTaskHK
from stagearea.tms_TaskOrderRelation  s
where not exists (select 1 from datavault.LinkAssignOrderTask t where t.HAssignOrderHK = s.HAssignOrderHK and t.HTaskHK = s.HTaskHK)
and s.LoadDate=${loaddate}
;
SELECT count(1) from datavault.linkorder;
SELECT count(1) from datavault.linkorderassignorder;
SELECT count(1) from datavault.linkassignordertask;
```







## 4. 卫星表

### 4.1 主键

| name           | code               | PK                            | FK                  |
| -------------- | ------------------ | ----------------------------- | ------------------- |
| 运单附属表     | HSatWaybill        | HWayBillHK, loadDate          | HWayBillHK          |
| 运单明细附属表 | LSatOrder          | OrderHK, loadDate             | OrderHK             |
| 辅助订单附属表 | HSatAssignOrder    | AssignOrderHK, loadDate       | AssignOrderHK       |
| 订单拼单附属表 | HSatAssignOrderDet | AssignOrderDetailHK, loadDate | AssignOrderDetailHK |
| 任务附属表     | HSatTask           | TaskHK, loadDate              | TaskHK              |

### 4.2 卫星表结构

| Table                    | Column                  | KeyType    |
| ------------------------ | ----------------------- | ---------- |
| **HSatWaybill**          | **HWayBillHK**          | **PK(FK)** |
| **HSatWaybill**          | **loadDate**            | **PK**     |
| HSatWaybill              | loadEndDate             |            |
| HSatWaybill              | RecordSource            |            |
| HSatWaybill              | TRANSPORTNR             | BK         |
| HSatWaybill              | ID                      |            |
| HSatWaybill              | ASSIGNATIONQTY          |            |
| HSatWaybill              | CODE                    |            |
| HSatWaybill              | CREATETYPE              |            |
| HSatWaybill              | CREATEDAT               |            |
| HSatWaybill              | CREATEDUSERID           |            |
| HSatWaybill              | DAY                     |            |
| HSatWaybill              | DEALERNAME              |            |
| HSatWaybill              | DESCRIPTION1            |            |
| HSatWaybill              | DESCRIPTION2            |            |
| HSatWaybill              | MONTH                   |            |
| HSatWaybill              | OEMREGION               |            |
| HSatWaybill              | ORGANIZATIONID          |            |
| HSatWaybill              | QTY                     |            |
| HSatWaybill              | REGION                  |            |
| HSatWaybill              | STATE                   |            |
| HSatWaybill              | UPDATEDAT               |            |
| HSatWaybill              | UPDATEDUSERID           |            |
| HSatWaybill              | WAYBILLDATE             |            |
| HSatWaybill              | YEAR                    |            |
| HSatWaybill              | DEPARTMENTID            |            |
| HSatWaybill              | ORIGINNAME              |            |
| HSatWaybill              | DESTINATIONNAME         |            |
| HSatWaybill              | AGENCYID                |            |
| HSatWaybill              | DEALERID                |            |
| HSatWaybill              | FREIGHT                 |            |
| HSatWaybill              | PROVINCEID              |            |
| HSatWaybill              | BACKDATE                |            |
| HSatWaybill              | RECEIPTDATE             |            |
| HSatWaybill              | DESCRIPTION             |            |
| HSatWaybill              | BRANDSTR                |            |
| **HSatCar**              | **HCarHK**              | **PK(FK)** |
| **HSatCar**              | **loadDate**            | **PK**     |
| HSatCar                  | TRANSPORTNR             | BK         |
| HSatCar                  | VIN                     | BK         |
| HSatCar                  | loadEndDate             |            |
| HSatCar                  | RecordSource            |            |
| HSatCar                  | ID                      |            |
| HSatCar                  | AFTERCARTYPE            |            |
| HSatCar                  | CARTYPE                 |            |
| HSatCar                  | COLOR                   |            |
| HSatCar                  | CREATETYPE              |            |
| HSatCar                  | CREATEDAT               |            |
| HSatCar                  | CREATEDUSERID           |            |
| HSatCar                  | DAY                     |            |
| HSatCar                  | DEALERNAME              |            |
| HSatCar                  | DESCRIPTION1            |            |
| HSatCar                  | DESCRIPTION2            |            |
| HSatCar                  | ISPAYABLE               |            |
| HSatCar                  | MONTH                   |            |
| HSatCar                  | OEMREGION               |            |
| HSatCar                  | ORGANIZATIONID          |            |
| HSatCar                  | QTY                     |            |
| HSatCar                  | REGION                  |            |
| HSatCar                  | STATE                   |            |
| HSatCar                  | UPDATEDAT               |            |
| HSatCar                  | UPDATEDUSERID           |            |
| HSatCar                  | YEAR                    |            |
| HSatCar                  | WAYBILL_ID              |            |
| HSatCar                  | ORIGINNAME              |            |
| HSatCar                  | DESTINATIONNAME         |            |
| HSatCar                  | AGENCYID                |            |
| HSatCar                  | BENZORDERID             |            |
| HSatCar                  | PROVINCEID              |            |
| **HSatAssignOrder**      | **HAssignOrderHK**      | **PK(FK)** |
| **HSatAssignOrder**      | **loadDate**            | **PK**     |
| HSatAssignOrder          | loadEndDate             |            |
| HSatAssignOrder          | RecordSource            |            |
| HSatAssignOrder          | ORDERNR                 | BK         |
| HSatAssignOrder          | ID                      |            |
| HSatAssignOrder          | CODE                    |            |
| HSatAssignOrder          | CREATEDAT               |            |
| HSatAssignOrder          | CREATEDUSERID           |            |
| HSatAssignOrder          | DAY                     |            |
| HSatAssignOrder          | DESCRIPTION1            |            |
| HSatAssignOrder          | DESCRIPTION2            |            |
| HSatAssignOrder          | DESTINATIONNAME         |            |
| HSatAssignOrder          | ENTRUCKTIME             |            |
| HSatAssignOrder          | ISAGENCYORDER           |            |
| HSatAssignOrder          | ISORIGINAL              |            |
| HSatAssignOrder          | ISPOOL                  |            |
| HSatAssignOrder          | MONTH                   |            |
| HSatAssignOrder          | OEMREGION               |            |
| HSatAssignOrder          | ORGANIZATIONID          |            |
| HSatAssignOrder          | ORIGINNAME              |            |
| HSatAssignOrder          | ORIGINALORDERNR         |            |
| HSatAssignOrder          | PLANDATE                |            |
| HSatAssignOrder          | QTY                     |            |
| HSatAssignOrder          | REALLYCARRIER           |            |
| HSatAssignOrder          | REGIONNAME              |            |
| HSatAssignOrder          | ROUTENAME               |            |
| HSatAssignOrder          | SHOULDCARRIER           |            |
| HSatAssignOrder          | STATE                   |            |
| HSatAssignOrder          | TYPE                    |            |
| HSatAssignOrder          | UPDATEDAT               |            |
| HSatAssignOrder          | UPDATEDUSERID           |            |
| HSatAssignOrder          | YEAR                    |            |
| HSatAssignOrder          | DEPARTMENTID            |            |
| HSatAssignOrder          | SHOULDCARRIERID         |            |
| HSatAssignOrder          | REALLYCARRIERID         |            |
| HSatAssignOrder          | REGIONNAMES             |            |
| HSatAssignOrder          | ISSEGMENTED             |            |
| HSatAssignOrder          | RELATEDORGANIZATION     |            |
| HSatAssignOrder          | ACTUALORIGINCITYID      |            |
| HSatAssignOrder          | ACTUALDESTINATIONCITYID |            |
| HSatAssignOrder          | RELATEDAGENCY           |            |
| HSatAssignOrder          | RELATEDAGENCYIDS        |            |
| HSatAssignOrder          | CARRIERDATE             |            |
| HSatAssignOrder          | RELATEDORDERS           |            |
| HSatAssignOrder          | DESCRIPTION             |            |
| HSatAssignOrder          | BRANDSTR                |            |
| **HSatTask**             | **HTaskHK**             | **PK(FK)** |
| **HSatTask**             | **LoadDate**            | **PK**     |
| HSatTask                 | LoadEndDate             |            |
| HSatTask                 | RecordSource            |            |
| HSatTask                 | TASKNUMBER              | BK         |
| HSatTask                 | ID                      |            |
| HSatTask                 | ACTUALARRIVALTIME       |            |
| HSatTask                 | ACTUALDEPARTURETIME     |            |
| HSatTask                 | BACKGROUND              |            |
| HSatTask                 | CARQTY                  |            |
| HSatTask                 | CARRIERMESSAGE          |            |
| HSatTask                 | CHECKDATE               |            |
| HSatTask                 | CODE                    |            |
| HSatTask                 | CREATEDAT               |            |
| HSatTask                 | CREATEDUSERID           |            |
| HSatTask                 | CURRENTPLACE            |            |
| HSatTask                 | DAY                     |            |
| HSatTask                 | DESCRIPTION             |            |
| HSatTask                 | DESPATCHPLANINDATE      |            |
| HSatTask                 | DESTINATIONNAME         |            |
| HSatTask                 | ENTRUCKINGDATE          |            |
| HSatTask                 | HEAVYDRIVINGTASK        |            |
| HSatTask                 | ISCHECK                 |            |
| HSatTask                 | ISPAYABLE               |            |
| HSatTask                 | MONTH                   |            |
| HSatTask                 | ORGANIZATIONID          |            |
| HSatTask                 | ORIGINNAME              |            |
| HSatTask                 | PLANDATE                |            |
| HSatTask                 | PLANARRIVALTIME         |            |
| HSatTask                 | PLANDEPARTURETIME       |            |
| HSatTask                 | QTY                     |            |
| HSatTask                 | REALLYCARRIER           |            |
| HSatTask                 | REGIONID                |            |
| HSatTask                 | RELATEDWAYBILL          |            |
| HSatTask                 | ROUTENAME               |            |
| HSatTask                 | STATE                   |            |
| HSatTask                 | TASKTYPE                |            |
| HSatTask                 | TRANSEXPECTTIME         |            |
| HSatTask                 | TYPE                    |            |
| HSatTask                 | UPDATEDAT               |            |
| HSatTask                 | UPDATEDUSERID           |            |
| HSatTask                 | YEAR                    |            |
| HSatTask                 | DEPARTMENTID            |            |
| HSatTask                 | DELIVERYCARDATE         |            |
| HSatTask                 | RELATEDORGANIZATION     |            |
| HSatTask                 | CARRIERTYPE             |            |
| HSatTask                 | DISTRIBUTIONCARUSERID   |            |
| HSatTask                 | DISTRIBUTIONCARUSERDATE |            |
| HSatTask                 | RELATEDAGENCY           |            |
| HSatTask                 | RELATEDAGENCYIDS        |            |
| HSatTask                 | LONGITUDE               |            |
| HSatTask                 | LATITUDE                |            |
| HSatTask                 | ISGENERATEEMPTY         |            |
| HSatTask                 | ISROLLBACKTASK          |            |
| HSatTask                 | RELATEDORDERS           |            |
| HSatTask                 | NEXTCARRIERTYPE         |            |
| HSatTask                 | BRANDSTR                |            |
| HSatTask                 | WAYBILLNR               |            |
| **LSatOrder**            | **LOrderHK**            | **PK(FK)** |
| **LSatOrder**            | **loadDate**            | **PK**     |
| LSatOrder                | TRANSPORTNR             | BK         |
| LSatOrder                | VIN                     | BK         |
| LSatOrder                | loadEndDate             |            |
| LSatOrder                | RecordSource            |            |
| LSatOrder                | ID                      |            |
| LSatOrder                | AFTERCARTYPE            |            |
| LSatOrder                | CARTYPE                 |            |
| LSatOrder                | COLOR                   |            |
| LSatOrder                | CREATETYPE              |            |
| LSatOrder                | CREATEDAT               |            |
| LSatOrder                | CREATEDUSERID           |            |
| LSatOrder                | DAY                     |            |
| LSatOrder                | DEALERNAME              |            |
| LSatOrder                | DESCRIPTION1            |            |
| LSatOrder                | DESCRIPTION2            |            |
| LSatOrder                | ISPAYABLE               |            |
| LSatOrder                | MONTH                   |            |
| LSatOrder                | OEMREGION               |            |
| LSatOrder                | ORGANIZATIONID          |            |
| LSatOrder                | QTY                     |            |
| LSatOrder                | REGION                  |            |
| LSatOrder                | STATE                   |            |
| LSatOrder                | UPDATEDAT               |            |
| LSatOrder                | UPDATEDUSERID           |            |
| LSatOrder                | YEAR                    |            |
| LSatOrder                | WAYBILL_ID              |            |
| LSatOrder                | ORIGINNAME              |            |
| LSatOrder                | DESTINATIONNAME         |            |
| LSatOrder                | AGENCYID                |            |
| LSatOrder                | BENZORDERID             |            |
| LSatOrder                | PROVINCEID              |            |
| **LSatOrderAssignOrder** | **LOrderAssignOrderHK** | **PK(FK)** |
| **LSatOrderAssignOrder** | **LoadDate**            | **PK**     |
| LSatOrderAssignOrder     | LoadEndDate             |            |
| LSatOrderAssignOrder     | RecordSource            |            |
| LSatOrderAssignOrder     | TRANSPORTNR             | BK         |
| LSatOrderAssignOrder     | VIN                     | BK         |
| LSatOrderAssignOrder     | ORDERNR                 | BK         |
| LSatOrderAssignOrder     | ID                      |            |
| LSatOrderAssignOrder     | AFTERCARTYPE            |            |
| LSatOrderAssignOrder     | CARTYPE                 |            |
| LSatOrderAssignOrder     | CODE                    |            |
| LSatOrderAssignOrder     | CREATETYPE              |            |
| LSatOrderAssignOrder     | CREATEDAT               |            |
| LSatOrderAssignOrder     | CREATEDUSERID           |            |
| LSatOrderAssignOrder     | DAY                     |            |
| LSatOrderAssignOrder     | DEALERNAME              |            |
| LSatOrderAssignOrder     | DESCRIPTION             |            |
| LSatOrderAssignOrder     | DESTINATIONNAME         |            |
| LSatOrderAssignOrder     | ISSELECTED              |            |
| LSatOrderAssignOrder     | MONTH                   |            |
| LSatOrderAssignOrder     | ORDERID                 |            |
| LSatOrderAssignOrder     | ORGANIZATIONID          |            |
| LSatOrderAssignOrder     | ORIGINNAME              |            |
| LSatOrderAssignOrder     | PLANDATE                |            |
| LSatOrderAssignOrder     | REGIONNAME              |            |
| LSatOrderAssignOrder     | STATE                   |            |
| LSatOrderAssignOrder     | UPDATEDAT               |            |
| LSatOrderAssignOrder     | UPDATEDUSERID           |            |
| LSatOrderAssignOrder     | YEAR                    |            |
| LSatOrderAssignOrder     | REGIONNAMES             |            |
| LSatOrderAssignOrder     | ISSEGMENTED             |            |
| LSatOrderAssignOrder     | ASSIGNORDERID           |            |
| LSatOrderAssignOrder     | ACTUALORIGINCITYID      |            |
| LSatOrderAssignOrder     | ACTUALDESTINATIONCITYID |            |
| LSatOrderAssignOrder     | ENTRUCKTIME             |            |
| **LSatAssignOrderTask**  | **LAssignOrderTaskHK**  | **PK(FK)** |
| **LSatAssignOrderTask**  | **LoadDate**            | **PK**     |
| LSatAssignOrderTask      | LoadEndDate             |            |
| LSatAssignOrderTask      | RecordSource            |            |
| LSatAssignOrderTask      | ORDERNR                 | BK         |
| LSatAssignOrderTask      | TaskNumber              | BK         |
| LSatAssignOrderTask      | ID                      | NUMBER     |
| LSatAssignOrderTask      | ASSIGNORDERID           | NUMBER     |
| LSatAssignOrderTask      | CODE                    | VARCHAR2   |
| LSatAssignOrderTask      | CREATEDAT               | DATE       |
| LSatAssignOrderTask      | CREATEDUSERID           | NUMBER     |
| LSatAssignOrderTask      | DESCRIPTION             | VARCHAR2   |
| LSatAssignOrderTask      | TASKMANAGEMENTID        | NUMBER     |
| LSatAssignOrderTask      | UPDATEDAT               | DATE       |
| LSatAssignOrderTask      | UPDATEDUSERID           | NUMBER     |



### 4.3 建表脚本

```sql
/**HSatWaybill*/		
create table datavault.HSatWaybill(		
	HWayBillHK	String
,	loadDate	Bigint
,	loadEndDate	Bigint
,	RecordSource	String
,	TRANSPORTNR	String
,	ID	Bigint
,	ASSIGNATIONQTY	Bigint
,	CODE	String
,	CREATETYPE	Bigint
,	CREATEDAT	Bigint
,	CREATEDUSERID	Bigint
,	DAY	Bigint
,	DEALERNAME	String
,	DESCRIPTION1	String
,	DESCRIPTION2	String
,	MONTH	Bigint
,	OEMREGION	String
,	ORGANIZATIONID	Bigint
,	QTY	Bigint
,	REGION	String
,	STATE	Bigint
,	UPDATEDAT	Bigint
,	UPDATEDUSERID	Bigint
,	WAYBILLDATE	Bigint
,	YEAR	Bigint
,	DEPARTMENTID	Bigint
,	ORIGINNAME	Bigint
,	DESTINATIONNAME	Bigint
,	AGENCYID	Bigint
,	DEALERID	Bigint
,	FREIGHT	Bigint
,	PROVINCEID	Bigint
,	BACKDATE	Bigint
,	RECEIPTDATE	Bigint
,	DESCRIPTION	String
,	BRANDSTR	String
,Primary Key(HWayBillHK,loadDate)		
)		
Partition By Hash(HWayBillHK)partitions 6		
,Range(loadDate)(		
Partition 0<=values<1538323200000	-- 2018/10/1	
,Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;		
		
/**HSatCar*/		
create table datavault.HSatCar(		
	HCarHK	String
,	loadDate	Bigint
,	loadEndDate	Bigint
,	RecordSource	String
,	TRANSPORTNR	String
,	VIN	String
,	ID	Bigint
,	AFTERCARTYPE	String
,	CARTYPE	String
,	COLOR	String
,	CREATETYPE	Bigint
,	CREATEDAT	Bigint
,	CREATEDUSERID	Bigint
,	DAY	Bigint
,	DEALERNAME	String
,	DESCRIPTION1	String
,	DESCRIPTION2	String
,	ISPAYABLE	Bigint
,	MONTH	Bigint
,	OEMREGION	String
,	ORGANIZATIONID	Bigint
,	QTY	Bigint
,	REGION	String
,	STATE	Bigint
,	UPDATEDAT	Bigint
,	UPDATEDUSERID	Bigint
,	YEAR	Bigint
,	WAYBILL_ID	Bigint
,	ORIGINNAME	Bigint
,	DESTINATIONNAME	Bigint
,	AGENCYID	Bigint
,	BENZORDERID	Bigint
,	PROVINCEID	Bigint
,Primary Key(HCarHK,loadDate)		
)		
Partition By Hash(HCarHK)partitions 6		
,Range(loadDate)(		
Partition 0<=values<1538323200000	-- 2018/10/1	
,Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;		
		
/**HSatAssignOrder*/		
create table datavault.HSatAssignOrder(		
	HAssignOrderHK	String
,	loadDate	Bigint
,	loadEndDate	Bigint
,	RecordSource	String
,	ORDERNR	String
,	ID	Bigint
,	CODE	String
,	CREATEDAT	Bigint
,	CREATEDUSERID	Bigint
,	DAY	Bigint
,	DESCRIPTION1	String
,	DESCRIPTION2	String
,	DESTINATIONNAME	Bigint
,	ENTRUCKTIME	Bigint
,	ISAGENCYORDER	Bigint
,	ISORIGINAL	Bigint
,	ISPOOL	Bigint
,	MONTH	Bigint
,	OEMREGION	String
,	ORGANIZATIONID	Bigint
,	ORIGINNAME	Bigint
,	ORIGINALORDERNR	String
,	PLANDATE	Bigint
,	QTY	Bigint
,	REALLYCARRIER	Bigint
,	REGIONNAME	Bigint
,	ROUTENAME	Bigint
,	SHOULDCARRIER	Bigint
,	STATE	Bigint
,	TYPE	Bigint
,	UPDATEDAT	Bigint
,	UPDATEDUSERID	Bigint
,	YEAR	Bigint
,	DEPARTMENTID	Bigint
,	SHOULDCARRIERID	Bigint
,	REALLYCARRIERID	Bigint
,	REGIONNAMES	String
,	ISSEGMENTED	Bigint
,	RELATEDORGANIZATION	String
,	ACTUALORIGINCITYID	Bigint
,	ACTUALDESTINATIONCITYID	Bigint
,	RELATEDAGENCY	String
,	RELATEDAGENCYIDS	String
,	CARRIERDATE	Bigint
,	RELATEDORDERS	String
,	DESCRIPTION	String
,	BRANDSTR	String
,Primary Key(HAssignOrderHK,loadDate)		
)		
Partition By Hash(HAssignOrderHK)partitions 6		
,Range(loadDate)(		
Partition 0<=values<1538323200000	-- 2018/10/1	
,Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;		
	
		
/**HSatTask*/		
create table datavault.HSatTask(		
	HTaskHK	String
,	LoadDate	Bigint
,	LoadEndDate	Bigint
,	RecordSource	String
,	TASKNUMBER	String
,	ID	Bigint
,	ACTUALARRIVALTIME	Bigint
,	ACTUALDEPARTURETIME	Bigint
,	BACKGROUND	Bigint
,	CARQTY	Bigint
,	CARRIERMESSAGE	String
,	CHECKDATE	Bigint
,	CODE	String
,	CREATEDAT	Bigint
,	CREATEDUSERID	Bigint
,	CURRENTPLACE	String
,	DAY	Bigint
,	DESCRIPTION	String
,	DESPATCHPLANINDATE	Bigint
,	DESTINATIONNAME	Bigint
,	ENTRUCKINGDATE	Bigint
,	HEAVYDRIVINGTASK	Bigint
,	ISCHECK	Bigint
,	ISPAYABLE	Bigint
,	MONTH	Bigint
,	ORGANIZATIONID	Bigint
,	ORIGINNAME	Bigint
,	PLANDATE	Bigint
,	PLANARRIVALTIME	Bigint
,	PLANDEPARTURETIME	Bigint
,	QTY	Bigint
,	REALLYCARRIER	Bigint
,	REGIONID	Bigint
,	RELATEDWAYBILL	String
,	ROUTENAME	Bigint
,	STATE	Bigint
,	TASKTYPE	Bigint
,	TRANSEXPECTTIME	Bigint
,	TYPE	Bigint
,	UPDATEDAT	Bigint
,	UPDATEDUSERID	Bigint
,	YEAR	Bigint
,	DEPARTMENTID	Bigint
,	DELIVERYCARDATE	Bigint
,	RELATEDORGANIZATION	String
,	CARRIERTYPE	Bigint
,	DISTRIBUTIONCARUSERID	Bigint
,	DISTRIBUTIONCARUSERDATE	Bigint
,	RELATEDAGENCY	String
,	RELATEDAGENCYIDS	String
,	LONGITUDE	Float
,	LATITUDE	Float
,	ISGENERATEEMPTY	Bigint
,	ISROLLBACKTASK	Bigint
,	RELATEDORDERS	String
,	NEXTCARRIERTYPE	Bigint
,	BRANDSTR	String
,	WAYBILLNR	String
,Primary Key(HTaskHK,loadDate)		
)		
Partition By Hash(HTaskHK)partitions 6		
,Range(loadDate)(		
 Partition 0<=values<1538323200000	-- 2018/10/1	
,  Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,  Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;	
/**LSatOrder*/		
create table datavault.LSatOrder(		
	LOrderHK	String
,	loadDate	Bigint
,	loadEndDate	Bigint
,	RecordSource	String
,	TRANSPORTNR	String
,	VIN	String
,	ID	Bigint
,	AFTERCARTYPE	String
,	CARTYPE	String
,	COLOR	String
,	CREATETYPE	Bigint
,	CREATEDAT	Bigint
,	CREATEDUSERID	Bigint
,	DAY	Bigint
,	DEALERNAME	String
,	DESCRIPTION1	String
,	DESCRIPTION2	String
,	ISPAYABLE	Bigint
,	MONTH	Bigint
,	OEMREGION	String
,	ORGANIZATIONID	Bigint
,	QTY	Bigint
,	REGION	String
,	STATE	Bigint
,	UPDATEDAT	Bigint
,	UPDATEDUSERID	Bigint
,	YEAR	Bigint
,	WAYBILL_ID	Bigint
,	ORIGINNAME	Bigint
,	DESTINATIONNAME	Bigint
,	AGENCYID	Bigint
,	BENZORDERID	Bigint
,	PROVINCEID	Bigint
,Primary Key(LOrderHK,loadDate)		
)		
Partition By Hash(LOrderHK)partitions 6		
,Range(loadDate)(		
Partition 0<=values<1538323200000	-- 2018/10/1	
,Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;		
				
		
/**LSatOrderAssignOrder*/		
create table datavault.LSatOrderAssignOrder(		
	LOrderAssignOrderHK	String
,	LoadDate	Bigint
,	LoadEndDate	Bigint
,	RecordSource	String
,	TRANSPORTNR	String
,	VIN	String
,	ORDERNR	String
,	ID	Bigint
,	AFTERCARTYPE	String
,	CARTYPE	String
,	CODE	String
,	CREATETYPE	Bigint
,	CREATEDAT	Bigint
,	CREATEDUSERID	Bigint
,	DAY	Bigint
,	DEALERNAME	String
,	DESCRIPTION	String
,	DESTINATIONNAME	Bigint
,	ISSELECTED	Bigint
,	MONTH	Bigint
,	ORDERID	Bigint
,	ORGANIZATIONID	Bigint
,	ORIGINNAME	Bigint
,	PLANDATE	Bigint
,	REGIONNAME	Bigint
,	STATE	Bigint
,	UPDATEDAT	Bigint
,	UPDATEDUSERID	Bigint
,	YEAR	Bigint
,	REGIONNAMES	String
,	ISSEGMENTED	Bigint
,	ASSIGNORDERID	Bigint
,	ACTUALORIGINCITYID	Bigint
,	ACTUALDESTINATIONCITYID	Bigint
,	ENTRUCKTIME	Bigint
,Primary Key(LOrderAssignOrderHK,loadDate)		
)		
Partition By Hash(LOrderAssignOrderHK)partitions 6		
,Range(loadDate)(		
Partition 0<=values<1538323200000	-- 2018/10/1	
,Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;		




/**LSatAssignOrderTask*/		
create table datavault.LSatAssignOrderTask(		
	LAssignOrderTaskHK	String
,	LoadDate	bigint
,	LoadEndDate	bigint
,	RecordSource	String
,	ORDERNR	String
,	TaskNumber	String
,	ID	bigint
,	ASSIGNORDERID	bigint
,	CODE	String
,	CREATEDAT	bigint
,	CREATEDUSERID	bigint
,	DESCRIPTION	String
,	TASKMANAGEMENTID	bigint
,	UPDATEDAT	bigint
,	UPDATEDUSERID	bigint
,Primary Key(LAssignOrderTaskHK,loadDate)		
)		
Partition By Hash(LAssignOrderTaskHK)partitions 6		
,Range(loadDate)(		
Partition 0<=values<1538323200000	-- 2018/10/1	
,Partition 1538323200000<=values<1546272000000	-- 2019/1/1	
,Partition 1546272000000<=values<1554048000000	-- 2019/4/1	
)		
stored as kudu;
	

```

### 4.4  Load Sat

```sql
/**HSatWaybill*/
INSERT INTO TABLE datavault.HSatWaybill
SELECT DISTINCT stg.HWayBillHK,
                stg.loadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.TRANSPORTNR,
                stg.ID,
                stg.ASSIGNATIONQTY,
                stg.CODE,
                stg.CREATETYPE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.DAY,
                stg.DEALERNAME,
                stg.DESCRIPTION1,
                stg.DESCRIPTION2,
                stg.MONTH,
                stg.OEMREGION,
                stg.ORGANIZATIONID,
                stg.QTY,
                stg.REGION,
                stg.STATE,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID,
                stg.WAYBILLDATE,
                stg.YEAR,
                stg.DEPARTMENTID,
                stg.ORIGINNAME,
                stg.DESTINATIONNAME,
                stg.AGENCYID,
                stg.DEALERID,
                stg.FREIGHT,
                stg.PROVINCEID,
                stg.BACKDATE,
                stg.RECEIPTDATE,
                stg.DESCRIPTION,
                stg.BRANDSTR
FROM stagearea.tms_Waybill AS stg
LEFT OUTER JOIN datavault.HSatWaybill sat ON (stg.HWayBillHK = sat.HWayBillHK
                                              AND sat.LoadEndDate IS NULL)
WHERE ( nvl(cast(stg.TRANSPORTNR AS string), '')!= nvl(cast(sat.TRANSPORTNR AS string),'')
       OR nvl(cast(stg.ID AS string), '')!= nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.ASSIGNATIONQTY AS string), '')!= nvl(cast(sat.ASSIGNATIONQTY AS string),'')
       OR nvl(cast(stg.CODE AS string), '')!= nvl(cast(sat.CODE AS string),'')
       OR nvl(cast(stg.CREATETYPE AS string), '')!= nvl(cast(sat.CREATETYPE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string), '')!= nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string), '')!= nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.DAY AS string), '')!= nvl(cast(sat.DAY AS string),'')
       OR nvl(cast(stg.DEALERNAME AS string), '')!= nvl(cast(sat.DEALERNAME AS string),'')
       OR nvl(cast(stg.DESCRIPTION1 AS string), '')!= nvl(cast(sat.DESCRIPTION1 AS string),'')
       OR nvl(cast(stg.DESCRIPTION2 AS string), '')!= nvl(cast(sat.DESCRIPTION2 AS string),'')
       OR nvl(cast(stg.MONTH AS string), '')!= nvl(cast(sat.MONTH AS string),'')
       OR nvl(cast(stg.OEMREGION AS string), '')!= nvl(cast(sat.OEMREGION AS string),'')
       OR nvl(cast(stg.ORGANIZATIONID AS string), '')!= nvl(cast(sat.ORGANIZATIONID AS string),'')
       OR nvl(cast(stg.QTY AS string), '')!= nvl(cast(sat.QTY AS string),'')
       OR nvl(cast(stg.REGION AS string), '')!= nvl(cast(sat.REGION AS string),'')
       OR nvl(cast(stg.STATE AS string), '')!= nvl(cast(sat.STATE AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string), '')!= nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string), '')!= nvl(cast(sat.UPDATEDUSERID AS string),'')
       OR nvl(cast(stg.WAYBILLDATE AS string), '')!= nvl(cast(sat.WAYBILLDATE AS string),'')
       OR nvl(cast(stg.YEAR AS string), '')!= nvl(cast(sat.YEAR AS string),'')
       OR nvl(cast(stg.DEPARTMENTID AS string), '')!= nvl(cast(sat.DEPARTMENTID AS string),'')
       OR nvl(cast(stg.ORIGINNAME AS string), '')!= nvl(cast(sat.ORIGINNAME AS string),'')
       OR nvl(cast(stg.DESTINATIONNAME AS string), '')!= nvl(cast(sat.DESTINATIONNAME AS string),'')
       OR nvl(cast(stg.AGENCYID AS string), '')!= nvl(cast(sat.AGENCYID AS string),'')
       OR nvl(cast(stg.DEALERID AS string), '')!= nvl(cast(sat.DEALERID AS string),'')
       OR nvl(cast(stg.FREIGHT AS string), '')!= nvl(cast(sat.FREIGHT AS string),'')
       OR nvl(cast(stg.PROVINCEID AS string), '')!= nvl(cast(sat.PROVINCEID AS string),'')
       OR nvl(cast(stg.BACKDATE AS string), '')!= nvl(cast(sat.BACKDATE AS string),'')
       OR nvl(cast(stg.RECEIPTDATE AS string), '')!= nvl(cast(sat.RECEIPTDATE AS string),'')
       OR nvl(cast(stg.DESCRIPTION AS string), '')!= nvl(cast(sat.DESCRIPTION AS string),'')
       OR nvl(cast(stg.BRANDSTR AS string), '')!= nvl(cast(sat.BRANDSTR AS string),''))
  AND stg.loadDate=${loaddate} ;
  
  
  
  /**HSatCar*/
INSERT INTO TABLE datavault.HSatCar
SELECT DISTINCT stg.HCarHK,
                stg.loadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.TRANSPORTNR,
                stg.VIN,
                stg.ID,
                stg.AFTERCARTYPE,
                stg.CARTYPE,
                stg.COLOR,
                stg.CREATETYPE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.DAY,
                stg.DEALERNAME,
                stg.DESCRIPTION1,
                stg.DESCRIPTION2,
                stg.ISPAYABLE,
                stg.MONTH,
                stg.OEMREGION,
                stg.ORGANIZATIONID,
                stg.QTY,
                stg.REGION,
                stg.STATE,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID,
                stg.YEAR,
                stg.WAYBILL_ID,
                stg.ORIGINNAME,
                stg.DESTINATIONNAME,
                stg.AGENCYID,
                stg.BENZORDERID,
                stg.PROVINCEID
FROM stagearea.tms_Orders AS stg
LEFT OUTER JOIN datavault.HSatCar sat ON (stg.HCarHK = sat.HCarHK
                                          AND sat.LoadEndDate IS NULL)
WHERE (nvl(cast(stg.TRANSPORTNR AS string),'') != nvl(cast(sat.TRANSPORTNR AS string),'')
       OR nvl(cast(stg.VIN AS string),'') != nvl(cast(sat.VIN AS string),'')
       OR nvl(cast(stg.ID AS string),'') != nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.AFTERCARTYPE AS string),'') != nvl(cast(sat.AFTERCARTYPE AS string),'')
       OR nvl(cast(stg.CARTYPE AS string),'') != nvl(cast(sat.CARTYPE AS string),'')
       OR nvl(cast(stg.COLOR AS string),'') != nvl(cast(sat.COLOR AS string),'')
       OR nvl(cast(stg.CREATETYPE AS string),'') != nvl(cast(sat.CREATETYPE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string),'') != nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string),'') != nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.DAY AS string),'') != nvl(cast(sat.DAY AS string),'')
       OR nvl(cast(stg.DEALERNAME AS string),'') != nvl(cast(sat.DEALERNAME AS string),'')
       OR nvl(cast(stg.DESCRIPTION1 AS string),'') != nvl(cast(sat.DESCRIPTION1 AS string),'')
       OR nvl(cast(stg.DESCRIPTION2 AS string),'') != nvl(cast(sat.DESCRIPTION2 AS string),'')
       OR nvl(cast(stg.ISPAYABLE AS string),'') != nvl(cast(sat.ISPAYABLE AS string),'')
       OR nvl(cast(stg.MONTH AS string),'') != nvl(cast(sat.MONTH AS string),'')
       OR nvl(cast(stg.OEMREGION AS string),'') != nvl(cast(sat.OEMREGION AS string),'')
       OR nvl(cast(stg.ORGANIZATIONID AS string),'') != nvl(cast(sat.ORGANIZATIONID AS string),'')
       OR nvl(cast(stg.QTY AS string),'') != nvl(cast(sat.QTY AS string),'')
       OR nvl(cast(stg.REGION AS string),'') != nvl(cast(sat.REGION AS string),'')
       OR nvl(cast(stg.STATE AS string),'') != nvl(cast(sat.STATE AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string),'') != nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string),'') != nvl(cast(sat.UPDATEDUSERID AS string),'')
       OR nvl(cast(stg.YEAR AS string),'') != nvl(cast(sat.YEAR AS string),'')
       OR nvl(cast(stg.WAYBILL_ID AS string),'') != nvl(cast(sat.WAYBILL_ID AS string),'')
       OR nvl(cast(stg.ORIGINNAME AS string),'') != nvl(cast(sat.ORIGINNAME AS string),'')
       OR nvl(cast(stg.DESTINATIONNAME AS string),'') != nvl(cast(sat.DESTINATIONNAME AS string),'')
       OR nvl(cast(stg.AGENCYID AS string),'') != nvl(cast(sat.AGENCYID AS string),'')
       OR nvl(cast(stg.BENZORDERID AS string),'') != nvl(cast(sat.BENZORDERID AS string),'')
       OR nvl(cast(stg.PROVINCEID AS string),'') != nvl(cast(sat.PROVINCEID AS string),''))
  AND stg.loadDate=${loaddate} ;
  
  
  /**HSatAssignOrder*/
INSERT INTO TABLE datavault.HSatAssignOrder
SELECT DISTINCT stg.HAssignOrderHK,
                stg.loadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.ORDERNR,
                stg.ID,
                stg.CODE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.DAY,
                stg.DESCRIPTION1,
                stg.DESCRIPTION2,
                stg.DESTINATIONNAME,
                stg.ENTRUCKTIME,
                stg.ISAGENCYORDER,
                stg.ISORIGINAL,
                stg.ISPOOL,
                stg.MONTH,
                stg.OEMREGION,
                stg.ORGANIZATIONID,
                stg.ORIGINNAME,
                stg.ORIGINALORDERNR,
                stg.PLANDATE,
                stg.QTY,
                stg.REALLYCARRIER,
                stg.REGIONNAME,
                stg.ROUTENAME,
                stg.SHOULDCARRIER,
                stg.STATE,
                stg.TYPE,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID,
                stg.YEAR,
                stg.DEPARTMENTID,
                stg.SHOULDCARRIERID,
                stg.REALLYCARRIERID,
                stg.REGIONNAMES,
                stg.ISSEGMENTED,
                stg.RELATEDORGANIZATION,
                stg.ACTUALORIGINCITYID,
                stg.ACTUALDESTINATIONCITYID,
                stg.RELATEDAGENCY,
                stg.RELATEDAGENCYIDS,
                stg.CARRIERDATE,
                stg.RELATEDORDERS,
                stg.DESCRIPTION,
                stg.BRANDSTR
FROM stagearea.tms_AssignOrder AS stg
LEFT OUTER JOIN datavault.HSatAssignOrder sat ON (stg.HAssignOrderHK = sat.HAssignOrderHK
                                                  AND sat.LoadEndDate IS NULL)
WHERE (nvl(cast(stg.ORDERNR AS string), '') != nvl(cast(sat.ORDERNR AS string),'')
       OR nvl(cast(stg.ID AS string), '') != nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.CODE AS string), '') != nvl(cast(sat.CODE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string), '') != nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string), '') != nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.DAY AS string), '') != nvl(cast(sat.DAY AS string),'')
       OR nvl(cast(stg.DESCRIPTION1 AS string), '') != nvl(cast(sat.DESCRIPTION1 AS string),'')
       OR nvl(cast(stg.DESCRIPTION2 AS string), '') != nvl(cast(sat.DESCRIPTION2 AS string),'')
       OR nvl(cast(stg.DESTINATIONNAME AS string), '') != nvl(cast(sat.DESTINATIONNAME AS string),'')
       OR nvl(cast(stg.ENTRUCKTIME AS string), '') != nvl(cast(sat.ENTRUCKTIME AS string),'')
       OR nvl(cast(stg.ISAGENCYORDER AS string), '') != nvl(cast(sat.ISAGENCYORDER AS string),'')
       OR nvl(cast(stg.ISORIGINAL AS string), '') != nvl(cast(sat.ISORIGINAL AS string),'')
       OR nvl(cast(stg.ISPOOL AS string), '') != nvl(cast(sat.ISPOOL AS string),'')
       OR nvl(cast(stg.MONTH AS string), '') != nvl(cast(sat.MONTH AS string),'')
       OR nvl(cast(stg.OEMREGION AS string), '') != nvl(cast(sat.OEMREGION AS string),'')
       OR nvl(cast(stg.ORGANIZATIONID AS string), '') != nvl(cast(sat.ORGANIZATIONID AS string),'')
       OR nvl(cast(stg.ORIGINNAME AS string), '') != nvl(cast(sat.ORIGINNAME AS string),'')
       OR nvl(cast(stg.ORIGINALORDERNR AS string), '') != nvl(cast(sat.ORIGINALORDERNR AS string),'')
       OR nvl(cast(stg.PLANDATE AS string), '') != nvl(cast(sat.PLANDATE AS string),'')
       OR nvl(cast(stg.QTY AS string), '') != nvl(cast(sat.QTY AS string),'')
       OR nvl(cast(stg.REALLYCARRIER AS string), '') != nvl(cast(sat.REALLYCARRIER AS string),'')
       OR nvl(cast(stg.REGIONNAME AS string), '') != nvl(cast(sat.REGIONNAME AS string),'')
       OR nvl(cast(stg.ROUTENAME AS string), '') != nvl(cast(sat.ROUTENAME AS string),'')
       OR nvl(cast(stg.SHOULDCARRIER AS string), '') != nvl(cast(sat.SHOULDCARRIER AS string),'')
       OR nvl(cast(stg.STATE AS string), '') != nvl(cast(sat.STATE AS string),'')
       OR nvl(cast(stg.TYPE AS string), '') != nvl(cast(sat.TYPE AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string), '') != nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string), '') != nvl(cast(sat.UPDATEDUSERID AS string),'')
       OR nvl(cast(stg.YEAR AS string), '') != nvl(cast(sat.YEAR AS string),'')
       OR nvl(cast(stg.DEPARTMENTID AS string), '') != nvl(cast(sat.DEPARTMENTID AS string),'')
       OR nvl(cast(stg.SHOULDCARRIERID AS string), '') != nvl(cast(sat.SHOULDCARRIERID AS string),'')
       OR nvl(cast(stg.REALLYCARRIERID AS string), '') != nvl(cast(sat.REALLYCARRIERID AS string),'')
       OR nvl(cast(stg.REGIONNAMES AS string), '') != nvl(cast(sat.REGIONNAMES AS string),'')
       OR nvl(cast(stg.ISSEGMENTED AS string), '') != nvl(cast(sat.ISSEGMENTED AS string),'')
       OR nvl(cast(stg.RELATEDORGANIZATION AS string), '') != nvl(cast(sat.RELATEDORGANIZATION AS string),'')
       OR nvl(cast(stg.ACTUALORIGINCITYID AS string), '') != nvl(cast(sat.ACTUALORIGINCITYID AS string),'')
       OR nvl(cast(stg.ACTUALDESTINATIONCITYID AS string), '') != nvl(cast(sat.ACTUALDESTINATIONCITYID AS string),'')
       OR nvl(cast(stg.RELATEDAGENCY AS string), '') != nvl(cast(sat.RELATEDAGENCY AS string),'')
       OR nvl(cast(stg.RELATEDAGENCYIDS AS string), '') != nvl(cast(sat.RELATEDAGENCYIDS AS string),'')
       OR nvl(cast(stg.CARRIERDATE AS string), '') != nvl(cast(sat.CARRIERDATE AS string),'')
       OR nvl(cast(stg.RELATEDORDERS AS string), '') != nvl(cast(sat.RELATEDORDERS AS string),'')
       OR nvl(cast(stg.DESCRIPTION AS string), '') != nvl(cast(sat.DESCRIPTION AS string),'')
       OR nvl(cast(stg.BRANDSTR AS string), '') != nvl(cast(sat.BRANDSTR AS string),'') )
  AND stg.loadDate=${loaddate} ;
  
  
  /**HSatTask*/
INSERT INTO TABLE datavault.HSatTask
SELECT DISTINCT stg.HTaskHK,
                stg.LoadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.TASKNUMBER,
                stg.ID,
                stg.ACTUALARRIVALTIME,
                stg.ACTUALDEPARTURETIME,
                stg.BACKGROUND,
                stg.CARQTY,
                stg.CARRIERMESSAGE,
                stg.CHECKDATE,
                stg.CODE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.CURRENTPLACE,
                stg.DAY,
                stg.DESCRIPTION,
                stg.DESPATCHPLANINDATE,
                stg.DESTINATIONNAME,
                stg.ENTRUCKINGDATE,
                stg.HEAVYDRIVINGTASK,
                stg.ISCHECK,
                stg.ISPAYABLE,
                stg.MONTH,
                stg.ORGANIZATIONID,
                stg.ORIGINNAME,
                stg.PLANDATE,
                stg.PLANARRIVALTIME,
                stg.PLANDEPARTURETIME,
                stg.QTY,
                stg.REALLYCARRIER,
                stg.REGIONID,
                stg.RELATEDWAYBILL,
                stg.ROUTENAME,
                stg.STATE,
                stg.TASKTYPE,
                stg.TRANSEXPECTTIME,
                stg.TYPE,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID,
                stg.YEAR,
                stg.DEPARTMENTID,
                stg.DELIVERYCARDATE,
                stg.RELATEDORGANIZATION,
                stg.CARRIERTYPE,
                stg.DISTRIBUTIONCARUSERID,
                stg.DISTRIBUTIONCARUSERDATE,
                stg.RELATEDAGENCY,
                stg.RELATEDAGENCYIDS,
                stg.LONGITUDE,
                stg.LATITUDE,
                stg.ISGENERATEEMPTY,
                stg.ISROLLBACKTASK,
                stg.RELATEDORDERS,
                stg.NEXTCARRIERTYPE,
                stg.BRANDSTR,
                stg.WAYBILLNR
FROM stagearea.tms_TaskManagement AS stg
LEFT OUTER JOIN datavault.HSatTask sat ON (stg.HTaskHK = sat.HTaskHK
                                           AND sat.LoadEndDate IS NULL)
WHERE (nvl(cast(stg.TASKNUMBER AS string),'') != nvl(cast(sat.TASKNUMBER AS string),'')
       OR nvl(cast(stg.ID AS string),'') != nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.ACTUALARRIVALTIME AS string),'') != nvl(cast(sat.ACTUALARRIVALTIME AS string),'')
       OR nvl(cast(stg.ACTUALDEPARTURETIME AS string),'') != nvl(cast(sat.ACTUALDEPARTURETIME AS string),'')
       OR nvl(cast(stg.BACKGROUND AS string),'') != nvl(cast(sat.BACKGROUND AS string),'')
       OR nvl(cast(stg.CARQTY AS string),'') != nvl(cast(sat.CARQTY AS string),'')
       OR nvl(cast(stg.CARRIERMESSAGE AS string),'') != nvl(cast(sat.CARRIERMESSAGE AS string),'')
       OR nvl(cast(stg.CHECKDATE AS string),'') != nvl(cast(sat.CHECKDATE AS string),'')
       OR nvl(cast(stg.CODE AS string),'') != nvl(cast(sat.CODE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string),'') != nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string),'') != nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.CURRENTPLACE AS string),'') != nvl(cast(sat.CURRENTPLACE AS string),'')
       OR nvl(cast(stg.DAY AS string),'') != nvl(cast(sat.DAY AS string),'')
       OR nvl(cast(stg.DESCRIPTION AS string),'') != nvl(cast(sat.DESCRIPTION AS string),'')
       OR nvl(cast(stg.DESPATCHPLANINDATE AS string),'') != nvl(cast(sat.DESPATCHPLANINDATE AS string),'')
       OR nvl(cast(stg.DESTINATIONNAME AS string),'') != nvl(cast(sat.DESTINATIONNAME AS string),'')
       OR nvl(cast(stg.ENTRUCKINGDATE AS string),'') != nvl(cast(sat.ENTRUCKINGDATE AS string),'')
       OR nvl(cast(stg.HEAVYDRIVINGTASK AS string),'') != nvl(cast(sat.HEAVYDRIVINGTASK AS string),'')
       OR nvl(cast(stg.ISCHECK AS string),'') != nvl(cast(sat.ISCHECK AS string),'')
       OR nvl(cast(stg.ISPAYABLE AS string),'') != nvl(cast(sat.ISPAYABLE AS string),'')
       OR nvl(cast(stg.MONTH AS string),'') != nvl(cast(sat.MONTH AS string),'')
       OR nvl(cast(stg.ORGANIZATIONID AS string),'') != nvl(cast(sat.ORGANIZATIONID AS string),'')
       OR nvl(cast(stg.ORIGINNAME AS string),'') != nvl(cast(sat.ORIGINNAME AS string),'')
       OR nvl(cast(stg.PLANDATE AS string),'') != nvl(cast(sat.PLANDATE AS string),'')
       OR nvl(cast(stg.PLANARRIVALTIME AS string),'') != nvl(cast(sat.PLANARRIVALTIME AS string),'')
       OR nvl(cast(stg.PLANDEPARTURETIME AS string),'') != nvl(cast(sat.PLANDEPARTURETIME AS string),'')
       OR nvl(cast(stg.QTY AS string),'') != nvl(cast(sat.QTY AS string),'')
       OR nvl(cast(stg.REALLYCARRIER AS string),'') != nvl(cast(sat.REALLYCARRIER AS string),'')
       OR nvl(cast(stg.REGIONID AS string),'') != nvl(cast(sat.REGIONID AS string),'')
       OR nvl(cast(stg.RELATEDWAYBILL AS string),'') != nvl(cast(sat.RELATEDWAYBILL AS string),'')
       OR nvl(cast(stg.ROUTENAME AS string),'') != nvl(cast(sat.ROUTENAME AS string),'')
       OR nvl(cast(stg.STATE AS string),'') != nvl(cast(sat.STATE AS string),'')
       OR nvl(cast(stg.TASKTYPE AS string),'') != nvl(cast(sat.TASKTYPE AS string),'')
       OR nvl(cast(stg.TRANSEXPECTTIME AS string),'') != nvl(cast(sat.TRANSEXPECTTIME AS string),'')
       OR nvl(cast(stg.TYPE AS string),'') != nvl(cast(sat.TYPE AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string),'') != nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string),'') != nvl(cast(sat.UPDATEDUSERID AS string),'')
       OR nvl(cast(stg.YEAR AS string),'') != nvl(cast(sat.YEAR AS string),'')
       OR nvl(cast(stg.DEPARTMENTID AS string),'') != nvl(cast(sat.DEPARTMENTID AS string),'')
       OR nvl(cast(stg.DELIVERYCARDATE AS string),'') != nvl(cast(sat.DELIVERYCARDATE AS string),'')
       OR nvl(cast(stg.RELATEDORGANIZATION AS string),'') != nvl(cast(sat.RELATEDORGANIZATION AS string),'')
       OR nvl(cast(stg.CARRIERTYPE AS string),'') != nvl(cast(sat.CARRIERTYPE AS string),'')
       OR nvl(cast(stg.DISTRIBUTIONCARUSERID AS string),'') != nvl(cast(sat.DISTRIBUTIONCARUSERID AS string),'')
       OR nvl(cast(stg.DISTRIBUTIONCARUSERDATE AS string),'') != nvl(cast(sat.DISTRIBUTIONCARUSERDATE AS string),'')
       OR nvl(cast(stg.RELATEDAGENCY AS string),'') != nvl(cast(sat.RELATEDAGENCY AS string),'')
       OR nvl(cast(stg.RELATEDAGENCYIDS AS string),'') != nvl(cast(sat.RELATEDAGENCYIDS AS string),'')
       OR nvl(cast(stg.LONGITUDE AS string),'') != nvl(cast(sat.LONGITUDE AS string),'')
       OR nvl(cast(stg.LATITUDE AS string),'') != nvl(cast(sat.LATITUDE AS string),'')
       OR nvl(cast(stg.ISGENERATEEMPTY AS string),'') != nvl(cast(sat.ISGENERATEEMPTY AS string),'')
       OR nvl(cast(stg.ISROLLBACKTASK AS string),'') != nvl(cast(sat.ISROLLBACKTASK AS string),'')
       OR nvl(cast(stg.RELATEDORDERS AS string),'') != nvl(cast(sat.RELATEDORDERS AS string),'')
       OR nvl(cast(stg.NEXTCARRIERTYPE AS string),'') != nvl(cast(sat.NEXTCARRIERTYPE AS string),'')
       OR nvl(cast(stg.BRANDSTR AS string),'') != nvl(cast(sat.BRANDSTR AS string),'')
       OR nvl(cast(stg.WAYBILLNR AS string),'') != nvl(cast(sat.WAYBILLNR AS string),'') )
  AND stg.loadDate=${loaddate} ;


  
  /**LSatOrder*/
INSERT INTO TABLE datavault.LSatOrder
SELECT DISTINCT stg.LOrderHK,
                stg.loadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.TRANSPORTNR,
                stg.VIN,
                stg.ID,
                stg.AFTERCARTYPE,
                stg.CARTYPE,
                stg.COLOR,
                stg.CREATETYPE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.DAY,
                stg.DEALERNAME,
                stg.DESCRIPTION1,
                stg.DESCRIPTION2,
                stg.ISPAYABLE,
                stg.MONTH,
                stg.OEMREGION,
                stg.ORGANIZATIONID,
                stg.QTY,
                stg.REGION,
                stg.STATE,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID,
                stg.YEAR,
                stg.WAYBILL_ID,
                stg.ORIGINNAME,
                stg.DESTINATIONNAME,
                stg.AGENCYID,
                stg.BENZORDERID,
                stg.PROVINCEID
FROM stagearea.tms_Orders AS stg
LEFT OUTER JOIN datavault.LSatOrder sat ON (stg.LOrderHK = sat.LOrderHK
                                            AND sat.LoadEndDate IS NULL)
WHERE (nvl(cast(stg.TRANSPORTNR AS string),'') !=nvl(cast(sat.TRANSPORTNR AS string),'')
       OR nvl(cast(stg.VIN AS string),'') !=nvl(cast(sat.VIN AS string),'')
       OR nvl(cast(stg.ID AS string),'') !=nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.AFTERCARTYPE AS string),'') !=nvl(cast(sat.AFTERCARTYPE AS string),'')
       OR nvl(cast(stg.CARTYPE AS string),'') !=nvl(cast(sat.CARTYPE AS string),'')
       OR nvl(cast(stg.COLOR AS string),'') !=nvl(cast(sat.COLOR AS string),'')
       OR nvl(cast(stg.CREATETYPE AS string),'') !=nvl(cast(sat.CREATETYPE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string),'') !=nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string),'') !=nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.DAY AS string),'') !=nvl(cast(sat.DAY AS string),'')
       OR nvl(cast(stg.DEALERNAME AS string),'') !=nvl(cast(sat.DEALERNAME AS string),'')
       OR nvl(cast(stg.DESCRIPTION1 AS string),'') !=nvl(cast(sat.DESCRIPTION1 AS string),'')
       OR nvl(cast(stg.DESCRIPTION2 AS string),'') !=nvl(cast(sat.DESCRIPTION2 AS string),'')
       OR nvl(cast(stg.ISPAYABLE AS string),'') !=nvl(cast(sat.ISPAYABLE AS string),'')
       OR nvl(cast(stg.MONTH AS string),'') !=nvl(cast(sat.MONTH AS string),'')
       OR nvl(cast(stg.OEMREGION AS string),'') !=nvl(cast(sat.OEMREGION AS string),'')
       OR nvl(cast(stg.ORGANIZATIONID AS string),'') !=nvl(cast(sat.ORGANIZATIONID AS string),'')
       OR nvl(cast(stg.QTY AS string),'') !=nvl(cast(sat.QTY AS string),'')
       OR nvl(cast(stg.REGION AS string),'') !=nvl(cast(sat.REGION AS string),'')
       OR nvl(cast(stg.STATE AS string),'') !=nvl(cast(sat.STATE AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string),'') !=nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string),'') !=nvl(cast(sat.UPDATEDUSERID AS string),'')
       OR nvl(cast(stg.YEAR AS string),'') !=nvl(cast(sat.YEAR AS string),'')
       OR nvl(cast(stg.WAYBILL_ID AS string),'') !=nvl(cast(sat.WAYBILL_ID AS string),'')
       OR nvl(cast(stg.ORIGINNAME AS string),'') !=nvl(cast(sat.ORIGINNAME AS string),'')
       OR nvl(cast(stg.DESTINATIONNAME AS string),'') !=nvl(cast(sat.DESTINATIONNAME AS string),'')
       OR nvl(cast(stg.AGENCYID AS string),'') !=nvl(cast(sat.AGENCYID AS string),'')
       OR nvl(cast(stg.BENZORDERID AS string),'') !=nvl(cast(sat.BENZORDERID AS string),'')
       OR nvl(cast(stg.PROVINCEID AS string),'') !=nvl(cast(sat.PROVINCEID AS string),'') )
  AND stg.loadDate=${loaddate} ;
  
  
 /**LSatOrderAssignOrder*/
INSERT INTO TABLE datavault.LSatOrderAssignOrder
SELECT DISTINCT stg.LOrderAssignOrderHK,
                stg.LoadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.TRANSPORTNR,
                stg.VIN,
                stg.ORDERNR,
                stg.ID,
                stg.AFTERCARTYPE,
                stg.CARTYPE,
                stg.CODE,
                stg.CREATETYPE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.DAY,
                stg.DEALERNAME,
                stg.DESCRIPTION,
                stg.DESTINATIONNAME,
                stg.ISSELECTED,
                stg.MONTH,
                stg.ORDERID,
                stg.ORGANIZATIONID,
                stg.ORIGINNAME,
                stg.PLANDATE,
                stg.REGIONNAME,
                stg.STATE,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID,
                stg.YEAR,
                stg.REGIONNAMES,
                stg.ISSEGMENTED,
                stg.ASSIGNORDERID,
                stg.ACTUALORIGINCITYID,
                stg.ACTUALDESTINATIONCITYID,
                stg.ENTRUCKTIME
FROM stagearea.tms_AssignOrderDetail AS stg
LEFT OUTER JOIN datavault.LSatOrderAssignOrder sat ON (stg.LOrderAssignOrderHK = sat.LOrderAssignOrderHK
                                                       AND sat.LoadEndDate IS NULL)
WHERE (nvl(cast(stg.TRANSPORTNR AS string),'') != nvl(cast(sat.TRANSPORTNR AS string),'')
       OR nvl(cast(stg.VIN AS string),'') != nvl(cast(sat.VIN AS string),'')
       OR nvl(cast(stg.ORDERNR AS string),'') != nvl(cast(sat.ORDERNR AS string),'')
       OR nvl(cast(stg.ID AS string),'') != nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.AFTERCARTYPE AS string),'') != nvl(cast(sat.AFTERCARTYPE AS string),'')
       OR nvl(cast(stg.CARTYPE AS string),'') != nvl(cast(sat.CARTYPE AS string),'')
       OR nvl(cast(stg.CODE AS string),'') != nvl(cast(sat.CODE AS string),'')
       OR nvl(cast(stg.CREATETYPE AS string),'') != nvl(cast(sat.CREATETYPE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string),'') != nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string),'') != nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.DAY AS string),'') != nvl(cast(sat.DAY AS string),'')
       OR nvl(cast(stg.DEALERNAME AS string),'') != nvl(cast(sat.DEALERNAME AS string),'')
       OR nvl(cast(stg.DESCRIPTION AS string),'') != nvl(cast(sat.DESCRIPTION AS string),'')
       OR nvl(cast(stg.DESTINATIONNAME AS string),'') != nvl(cast(sat.DESTINATIONNAME AS string),'')
       OR nvl(cast(stg.ISSELECTED AS string),'') != nvl(cast(sat.ISSELECTED AS string),'')
       OR nvl(cast(stg.MONTH AS string),'') != nvl(cast(sat.MONTH AS string),'')
       OR nvl(cast(stg.ORDERID AS string),'') != nvl(cast(sat.ORDERID AS string),'')
       OR nvl(cast(stg.ORGANIZATIONID AS string),'') != nvl(cast(sat.ORGANIZATIONID AS string),'')
       OR nvl(cast(stg.ORIGINNAME AS string),'') != nvl(cast(sat.ORIGINNAME AS string),'')
       OR nvl(cast(stg.PLANDATE AS string),'') != nvl(cast(sat.PLANDATE AS string),'')
       OR nvl(cast(stg.REGIONNAME AS string),'') != nvl(cast(sat.REGIONNAME AS string),'')
       OR nvl(cast(stg.STATE AS string),'') != nvl(cast(sat.STATE AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string),'') != nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string),'') != nvl(cast(sat.UPDATEDUSERID AS string),'')
       OR nvl(cast(stg.YEAR AS string),'') != nvl(cast(sat.YEAR AS string),'')
       OR nvl(cast(stg.REGIONNAMES AS string),'') != nvl(cast(sat.REGIONNAMES AS string),'')
       OR nvl(cast(stg.ISSEGMENTED AS string),'') != nvl(cast(sat.ISSEGMENTED AS string),'')
       OR nvl(cast(stg.ASSIGNORDERID AS string),'') != nvl(cast(sat.ASSIGNORDERID AS string),'')
       OR nvl(cast(stg.ACTUALORIGINCITYID AS string),'') != nvl(cast(sat.ACTUALORIGINCITYID AS string),'')
       OR nvl(cast(stg.ACTUALDESTINATIONCITYID AS string),'') != nvl(cast(sat.ACTUALDESTINATIONCITYID AS string),'')
       OR nvl(cast(stg.ENTRUCKTIME AS string),'') != nvl(cast(sat.ENTRUCKTIME AS string),''))
  AND stg.loadDate=${loaddate} ;


/**LSatAssignOrderTask*/
INSERT INTO TABLE datavault.LSatAssignOrderTask
SELECT DISTINCT stg.LAssignOrderTaskHK,
                stg.LoadDate,
                NULL AS loadEndDate,
                stg.RecordSource,
                stg.ORDERNR,
                stg.TaskNumber,
                stg.ID,
                stg.ASSIGNORDERID,
                stg.CODE,
                stg.CREATEDAT,
                stg.CREATEDUSERID,
                stg.DESCRIPTION,
                stg.TASKMANAGEMENTID,
                stg.UPDATEDAT,
                stg.UPDATEDUSERID
FROM stagearea.tms_TaskOrderRelation AS stg
LEFT OUTER JOIN datavault.LSatAssignOrderTask sat ON (stg.LAssignOrderTaskHK = sat.LAssignOrderTaskHK
                                                      AND sat.LoadEndDate IS NULL)
WHERE (nvl(cast(stg.ORDERNR AS string),'') != nvl(cast(sat.ORDERNR AS string),'')
       OR nvl(cast(stg.TaskNumber AS string),'') != nvl(cast(sat.TaskNumber AS string),'')
       OR nvl(cast(stg.ID AS string),'') != nvl(cast(sat.ID AS string),'')
       OR nvl(cast(stg.ASSIGNORDERID AS string),'') != nvl(cast(sat.ASSIGNORDERID AS string),'')
       OR nvl(cast(stg.CODE AS string),'') != nvl(cast(sat.CODE AS string),'')
       OR nvl(cast(stg.CREATEDAT AS string),'') != nvl(cast(sat.CREATEDAT AS string),'')
       OR nvl(cast(stg.CREATEDUSERID AS string),'') != nvl(cast(sat.CREATEDUSERID AS string),'')
       OR nvl(cast(stg.DESCRIPTION AS string),'') != nvl(cast(sat.DESCRIPTION AS string),'')
       OR nvl(cast(stg.TASKMANAGEMENTID AS string),'') != nvl(cast(sat.TASKMANAGEMENTID AS string),'')
       OR nvl(cast(stg.UPDATEDAT AS string),'') != nvl(cast(sat.UPDATEDAT AS string),'')
       OR nvl(cast(stg.UPDATEDUSERID AS string),'') != nvl(cast(sat.UPDATEDUSERID AS string),'') )
  AND stg.loadDate=${loaddate} ;  
```



## 注意事项

1. `卫星表`加载的过程中需要对比每个字段， 当表格字段太多时，就需要对比特别多字段，影响性能，此时更好的做法是在`Stage`阶段加入`HashDiff`字段，该字段可以hash整个记录，从而在加载数据到`DataVault`时，只需要比较`HashDiff`就行，无需比较那么多字段；



2. 执行插入操作时， 对于Hub，用来识别是否重复的字段时是BK，因为这样除了可以避免hash冲突带来的问题，并在后续操作中暴露出哈希冲突的问题；（如果直接用Pk，则Hash冲突会被直接Ignore）
3. 在插入Link时，用来识别是否重复的字段时是FK组合，这种方式跟前面第二点类似；可以暴露出LinkHK的哈希碰撞问题（ hash collision）；









## 问题

1. 对于各种类型的表，在HashPartition时，可以按照HashKey做分桶，但是对于Range Partition 切片时，应该根据哪个字段会比较好？ （目前的情况，因为LoadDate是Sat卫星表的主键，所以根据Loaddate做RangePartition）
2. kudu 建表之后，能够通过Alter语句对kudu表的分区进行什么程度的操作？（当前仅支持添加新的Range分区进来。Hash分区以及已有的Range分区改不了）









